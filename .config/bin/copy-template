#!/usr/bin/env python

from dataclasses import dataclass
from enum import StrEnum, auto
from pathlib import Path
from typing import Self


class Language(StrEnum):
    LUA = auto()

    def file(self) -> str:
        match self:
            case Language.LUA:
                return ".stylua.toml"


@dataclass(frozen=True)
class Root:
    path: Path
    language: Language


@dataclass(frozen=True)
class Template:
    data: Path

    @classmethod
    def new(cls) -> Self:
        current = Path(__file__).resolve()
        data = current.parent / "data"
        assert data.is_dir()
        return cls(data=data)

    def copy(self, root: Root) -> None:
        print(f"copying {root.language} template to {root.path}")
        if not root.path.is_dir():
            print("  - skipping: not a directory")
        else:
            file = root.language.file()
            src = self.data / file
            assert src.is_file()
            dst = root.path / file
            verb = "replacing" if dst.exists() else "creating"
            print(f"  - {verb}: {file}")
            src.copy(dst)


def main() -> None:
    template = Template.new()
    for root in get_roots():
        template.copy(root)


def get_roots() -> list[Root]:
    config = Path.home() / ".config"
    repos = Path.home() / "dev/repos/personal"
    return [
        Root(config / "nvim", Language.LUA),
        Root(config / "wezterm", Language.LUA),
        Root(repos / "dashboard.nvim", Language.LUA),
        Root(repos / "harpoon-core.nvim", Language.LUA),
        Root(repos / "py-requirements.nvim", Language.LUA),
        Root(repos / "render-markdown.nvim", Language.LUA),
        Root(repos / "stashpad.nvim", Language.LUA),
        Root(repos / "treesitter-modules.nvim", Language.LUA),
    ]


if __name__ == "__main__":
    main()
